{% if include.show_events %}
<div class="container animate">
  <div class="row">

    {% assign now = 'now' | date: '%s' %}

    {%- comment -%}
    1. Collect only future events
    {%- endcomment -%}
    {% assign future_events = "" | split: "" %}
    {% for event in site.evenements %}
      {% assign event_ts = event.event_date | date: '%s' %}
      {% if event_ts >= now %}
        {% assign future_events = future_events | push: event %}
      {% endif %}
    {% endfor %}

    {%- comment -%}
    2. Sort events by date
    {%- endcomment -%}
    {% assign future_events = future_events | sort: "event_date" %}

    {%- comment -%}
    3. Loop and group by month
    {%- endcomment -%}
    {% assign current_month = "" %}

    {% for event in future_events %}
      {% assign event_month = event.event_date | date: "%B %Y" %}

      {% if event_month != current_month %}
        {% unless forloop.first %}
          </div> <!-- close previous month row -->
        {% endunless %}

        <h2 class="event-month-title">{{ event_month }}</h2>
        <div class="row">
        {% assign current_month = event_month %}
      {% endif %}

      {% bookshop event-card event=event %}
    {% endfor %}

    </div> <!-- close last row -->
  </div>
</div>
{% endif %}