{% if include.show_events %}
<div class="container animate">

  {% assign now = 'now' | date: '%s' %}

  {%- comment -%}
  French month lookup table
  {%- endcomment -%}
  {% assign mois_fr = "01:janvier,02:février,03:mars,04:avril,05:mai,06:juin,07:juillet,08:août,09:septembre,10:octobre,11:novembre,12:décembre" | split: "," %}

  {%- comment -%}
  Collect events (future or past depending on include.past_events)
  {%- endcomment -%}
  {% assign selected_events = "" | split: "" %}

  {% for event in site.evenements %}
    {% assign ts = event.event_date | date: "%s" %}

    {% if include.past_events %}
      {% if ts < now %}
        {% assign enriched = event | merge: hash: "ts", ts %}
        {% assign selected_events = selected_events | push: enriched %}
      {% endif %}
    {% else %}
      {% if ts >= now %}
        {% assign enriched = event | merge: hash: "ts", ts %}
        {% assign selected_events = selected_events | push: enriched %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {%- comment -%}
  Sort events
  - future events → chronological
  - past events → reverse chronological
  {%- endcomment -%}
  {% assign selected_events = selected_events | sort: "ts" %}
  {% if include.past_events %}
    {% assign selected_events = selected_events | reverse %}
  {% endif %}

  {%- comment -%}
  Loop + group by month
  {%- endcomment -%}
  {% assign current_month = "" %}

  {% for event in selected_events %}

    {% assign month_num = event.event_date | date: "%m" %}
    {% assign year_num  = event.event_date | date: "%Y" %}

    {%- comment -%}
    Convert month number → French month name
    {%- endcomment -%}
    {% assign month_fr = "" %}
    {% for pair in mois_fr %}
      {% assign parts = pair | split: ":" %}
      {% if parts[0] == month_num %}
        {% assign month_fr = parts[1] %}
      {% endif %}
    {% endfor %}

    {% assign event_month = month_fr | append: " " | append: year_num %}

    {% if event_month != current_month %}
      {% unless forloop.first %}
        </div> <!-- close previous month row -->
      {% endunless %}

      <h2 class="event-month-title">{{ event_month }}</h2>
      <div class="row">
      {% assign current_month = event_month %}
    {% endif %}

    {% bookshop event-card event=event %}
  {% endfor %}

  </div> <!-- close last row -->
</div>
{% endif %}
